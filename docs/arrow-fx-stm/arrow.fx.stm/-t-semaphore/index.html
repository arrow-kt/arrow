<!doctype html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>TSemaphore</title>
<link href="../../../images/logo-icon.svg" rel="icon" type="image/svg"><script>var pathToRoot = "../../../";</script>    <script>const storage = localStorage.getItem("dokka-dark-mode")
    if (storage == null) {
        const osDarkSchemePreferred = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
        if (osDarkSchemePreferred === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    } else {
        const savedDarkMode = JSON.parse(storage)
        if(savedDarkMode === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    }
    </script>
<script type="text/javascript" src="../../../scripts/sourceset_dependencies.js" async></script>
<link href="../../../styles/style.css" rel="Stylesheet">
<link href="../../../styles/jetbrains-mono.css" rel="Stylesheet">
<link href="../../../styles/main.css" rel="Stylesheet">
<link href="../../../styles/prism.css" rel="Stylesheet">
<link href="../../../styles/logo-styles.css" rel="Stylesheet">
<script type="text/javascript" src="../../../scripts/clipboard.js" async></script>
<script type="text/javascript" src="../../../scripts/navigation-loader.js" async></script>
<script type="text/javascript" src="../../../scripts/platform-content-handler.js" async></script>
<script type="text/javascript" src="../../../scripts/main.js" defer></script>
<script type="text/javascript" src="../../../scripts/prism.js" async></script>
<script type="text/javascript" src="../../../scripts/symbol-parameters-wrapper_deferred.js" defer></script></head>
<body>
<div class="navigation-wrapper" id="navigation-wrapper">
    <div id="leftToggler"><span class="icon-toggler"></span></div>
    <div class="library-name">
<a href="../../../index.html">
<span>Arrow</span>            </a>    </div>
    <div>1.1.6-alpha.32.1+2023-02-22T17-49-18-189485Z
    </div>
    <div class="pull-right d-flex">
        <button id="theme-toggle-button"><span id="theme-toggle"></span></button>
        <div id="searchBar"></div>
    </div>
</div>
<div id="container">
    <div id="leftColumn">
        <div id="sideMenu"></div>
    </div>
    <div id="main">
<div class="main-content" id="content" pageids="arrow-fx-stm::arrow.fx.stm/TSemaphore///PointingToDeclaration//-2117640706">
  <div class="breadcrumbs"><a href="../../index.html">arrow-fx-stm</a><span class="delimiter">/</span><a href="../index.html">arrow.fx.stm</a><span class="delimiter">/</span><span class="current">TSemaphore</span></div>
  <div class="cover ">
    <h1 class="cover"><span><span>TSemaphore</span></span></h1>
    <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":arrow-fx-stm:dokkaHtmlPartial/commonMain"><div class="symbol monospace"><span class="token keyword">data </span><span class="token keyword">class </span><a href="index.html">TSemaphore</a><span class="clearfix"><span class="floating-right">(<a href="https://github.com/arrow-kt/arrow//blob/main/arrow-libs/fx/arrow-fx-stm/src/commonMain/kotlin/arrow/fx/stm/TSemaphore.kt#L5">source</a>)</span></span></div><p class="paragraph"><a href="index.html">TSemaphore</a> is the transactional Semaphore.</p><p class="paragraph">Semaphores are mostly used to limit concurrent access to resources by how many permits it can give out.</p><h2 class=""> Creating a <a href="index.html">TSemaphore</a></h2><p class="paragraph">A <a href="index.html">TSemaphore</a> is created by using either <a href="-companion/new.html">TSemaphore.new</a> outside of transactions or <a href="../new-t-sem.html">STM.newTSem</a> inside a transaction. Both of these methods throw if the supplied initial value is negative.</p><h2 class=""> Acquiring one or more permits</h2><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">import arrow.fx.stm.TSemaphore<br>import arrow.fx.stm.atomically<br><br>suspend fun main() {<br>  //sampleStart<br>  val tsem = TSemaphore.new(5)<br>  atomically {<br>    // acquire one permit<br>    tsem.acquire()<br>    // acquire 3 permits<br>    tsem.acquire(3)<br>  }<br>  //sampleEnd<br>  println("Permits remaining ${atomically { tsem.available() }}")<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><!-- KNIT example-tsemaphore-01.kt --><p class="paragraph">Should there be not enough permits the transaction will retry and wait until there are enough permits available again. <a href="../-s-t-m/try-acquire.html">STM.tryAcquire</a> can be used to avoid this behaviour as it returns whether or not acquisition was successful.</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">import arrow.fx.stm.TSemaphore<br>import arrow.fx.stm.atomically<br><br>suspend fun main() {<br>  //sampleStart<br>  val tsem = TSemaphore.new(0)<br>  val result = atomically {<br>    tsem.tryAcquire()<br>  }<br>  //sampleEnd<br>  println("Result $result")<br>  println("Permits remaining ${atomically { tsem.available() }}")<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><!-- KNIT example-tsemaphore-02.kt --><h2 class=""> Release permits after use:</h2><p class="paragraph">Permits can be released again using <a href="../-s-t-m/release.html">STM.release</a>:</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">import arrow.fx.stm.TSemaphore<br>import arrow.fx.stm.atomically<br><br>suspend fun main() {<br>  //sampleStart<br>  val tsem = TSemaphore.new(5)<br>  atomically {<br>    tsem.release()<br>  }<br>  //sampleEnd<br>  println("Permits remaining ${atomically { tsem.available() }}")<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><!-- KNIT example-tsemaphore-03.kt --><blockquote class="quotation"><p class="paragraph">As you can see there is no upper limit enforced when releasing. You are free to release more or less permits than you have taken, but that may invalidate some other implicit rules so doing so is not advised.</p></blockquote><blockquote class="quotation"><p class="paragraph"><a href="../-s-t-m/release.html">STM.release</a> will throw if given a negative number of permits.</p></blockquote><h2 class=""> Reading how many permits are currently available</h2><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">import arrow.fx.stm.TSemaphore<br>import arrow.fx.stm.atomically<br><br>suspend fun main() {<br>  //sampleStart<br>  val tsem = TSemaphore.new(5)<br>  val result = atomically {<br>    tsem.available()<br>  }<br>  //sampleEnd<br>  println("Result $result")<br>  println("Permits remaining ${atomically { tsem.available() }}")<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><!-- KNIT example-tsemaphore-04.kt --></div></div>
  </div>
  <div class="tabbedcontent">
    <div class="tabs-section" tabs-section="tabs-section"><button class="section-tab" data-active="" data-togglable="Types">Types</button></div>
    <div class="tabs-section-body">
      <h2 class="">Types</h2>
      <div class="table" data-togglable="Types"><a data-name="-1266094295%2FClasslikes%2F-2117640706" anchor-label="Companion" id="-1266094295%2FClasslikes%2F-2117640706" data-filterable-set=":arrow-fx-stm:dokkaHtmlPartial/commonMain"></a>
        <div class="table-row" data-filterable-current=":arrow-fx-stm:dokkaHtmlPartial/commonMain" data-filterable-set=":arrow-fx-stm:dokkaHtmlPartial/commonMain">
          <div class="main-subrow keyValue ">
            <div class=""><span class="inline-flex">
                <div><a href="-companion/index.html"><span><span>Companion</span></span></a></div>
<span class="anchor-wrapper"><span class="anchor-icon" pointing-to="-1266094295%2FClasslikes%2F-2117640706"></span>
                  <div class="copy-popup-wrapper "><span class="copy-popup-icon"></span><span>Link copied to clipboard</span></div>
                </span></span></div>
            <div>
              <div class="title">
                <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":arrow-fx-stm:dokkaHtmlPartial/commonMain"><div class="symbol monospace"><span class="token keyword">object </span><a href="-companion/index.html">Companion</a></div></div></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
      <div class="footer">
        <span class="go-to-top-icon"><a href="#content" id="go-to-top-link"></a></span><span>Â© 2023 Copyright</span><span class="pull-right"><span>Generated by </span><a href="https://github.com/Kotlin/dokka"><span>dokka</span><span class="padded-icon"></span></a></span>
      </div>
    </div>
</div>

</body></html>

