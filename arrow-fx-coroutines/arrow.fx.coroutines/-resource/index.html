<!doctype html>
<html class="no-js">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1" charset="UTF-8">
    <title>Resource</title>
<link href="../../../images/logo-icon.svg" rel="icon" type="image/svg">    <script>var pathToRoot = "../../../";</script>
    <script>document.documentElement.classList.replace("no-js","js");</script>
    <script>const storage = localStorage.getItem("dokka-dark-mode")
    if (storage == null) {
        const osDarkSchemePreferred = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches
        if (osDarkSchemePreferred === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    } else {
        const savedDarkMode = JSON.parse(storage)
        if(savedDarkMode === true) {
            document.getElementsByTagName("html")[0].classList.add("theme-dark")
        }
    }
    </script>
<script type="text/javascript" src="https://unpkg.com/kotlin-playground@1/dist/playground.min.js" async></script>
<script type="text/javascript" src="../../../scripts/sourceset_dependencies.js" async></script>
<link href="../../../styles/style.css" rel="Stylesheet">
<link href="../../../styles/main.css" rel="Stylesheet">
<link href="../../../styles/prism.css" rel="Stylesheet">
<link href="../../../styles/logo-styles.css" rel="Stylesheet">
<link href="../../../styles/font-jb-sans-auto.css" rel="Stylesheet">
<link href="../../../ui-kit/ui-kit.min.css" rel="Stylesheet">
<script type="text/javascript" src="../../../scripts/clipboard.js" async></script>
<script type="text/javascript" src="../../../scripts/navigation-loader.js" async></script>
<script type="text/javascript" src="../../../scripts/platform-content-handler.js" async></script>
<script type="text/javascript" src="../../../scripts/main.js" defer></script>
<script type="text/javascript" src="../../../scripts/prism.js" async></script>
<script type="text/javascript" src="../../../ui-kit/ui-kit.min.js" defer></script>
<script type="text/javascript" src="../../../scripts/symbol-parameters-wrapper_deferred.js" defer></script></head>
<body>
    <div class="root">
    <nav class="navigation theme-dark" id="navigation-wrapper">
<a class="library-name--link" href="../../../index.html">
                    Arrow
            </a>        <button class="navigation-controls--btn navigation-controls--btn_toc ui-kit_mobile-only" id="toc-toggle" type="button">Toggle table of contents
        </button>
        <div class="navigation-controls--break ui-kit_mobile-only"></div>
        <div class="library-version" id="library-version">2.0.1
        </div>
        <div class="navigation-controls">
        <div class="filter-section filter-section_loading" id="filter-section">
                <button class="platform-tag platform-selector common-like" data-active="" data-filter=":arrow-fx-coroutines/commonMain">common</button>
            <div class="dropdown filter-section--dropdown" data-role="dropdown" id="filter-section-dropdown">
                <button class="button button_dropdown filter-section--dropdown-toggle" role="combobox" data-role="dropdown-toggle" aria-controls="platform-tags-listbox" aria-haspopup="listbox" aria-expanded="false" aria-label="Toggle source sets"></button>
                <ul role="listbox" id="platform-tags-listbox" class="dropdown--list" data-role="dropdown-listbox">
                    <div class="dropdown--header"><span>Platform filter</span>
                        <button class="button" data-role="dropdown-toggle" aria-label="Close platform filter">
                            <i class="ui-kit-icon ui-kit-icon_cross"></i>
                        </button>
                    </div>
                        <li role="option" class="dropdown--option platform-selector-option common-like" tabindex="0">
                            <label class="checkbox">
                                <input type="checkbox" class="checkbox--input" id=":arrow-fx-coroutines/commonMain" data-filter=":arrow-fx-coroutines/commonMain">
                                <span class="checkbox--icon"></span>
                                common
                            </label>
                        </li>
                </ul>
                <div class="dropdown--overlay"></div>
            </div>
        </div>
            <button class="navigation-controls--btn navigation-controls--btn_theme" id="theme-toggle-button" type="button">Switch theme
            </button>
            <div class="navigation-controls--btn navigation-controls--btn_search" id="searchBar" role="button">Search in
                API
            </div>
        </div>
    </nav>
        <div id="container">
            <div class="sidebar" id="leftColumn">
                <div class="dropdown theme-dark_mobile" data-role="dropdown" id="toc-dropdown">
                    <ul role="listbox" id="toc-listbox" class="dropdown--list dropdown--list_toc-list" data-role="dropdown-listbox">
                        <div class="dropdown--header">
                            <span>
                                    Arrow
                            </span>
                            <button class="button" data-role="dropdown-toggle" aria-label="Close table of contents">
                                <i class="ui-kit-icon ui-kit-icon_cross"></i>
                            </button>
                        </div>
                        <div class="sidebar--inner" id="sideMenu"></div>
                    </ul>
                    <div class="dropdown--overlay"></div>
                </div>
            </div>
            <div id="main">
<div class="main-content" data-page-type="classlike" id="content" pageids="arrow-fx-coroutines::arrow.fx.coroutines/Resource///PointingToDeclaration//1374329387">
  <div class="breadcrumbs"><a href="../../index.html">arrow-fx-coroutines</a><span class="delimiter">/</span><a href="../index.html">arrow.fx.coroutines</a><span class="delimiter">/</span><span class="current">Resource</span></div>
  <div class="cover ">
    <h1 class="cover"><span><span>Resource</span></span></h1>
    <div class="platform-hinted " data-platform-hinted="data-platform-hinted"><div class="content sourceset-dependent-content" data-active="" data-togglable=":arrow-fx-coroutines/commonMain"><div class="symbol monospace"><span class="token keyword">typealias </span><a href="index.html">Resource</a><span class="token operator">&lt;</span><a href="index.html">A</a><span class="token operator">&gt;</span><span class="token operator"> = </span><span class="token keyword">suspend </span><a href="../-resource-scope/index.html">ResourceScope</a><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator"> -&gt; </span><a href="index.html">A</a></div><p class="paragraph"><a href="index.html">Resource</a> models resource allocation and releasing. It is especially useful when multiple resources that depend on each other need to be acquired and later released in reverse order. The capability of <i>installing</i> resources is called <a href="../-resource-scope/index.html">ResourceScope</a>, and <a href="index.html">Resource</a> defines the value associating the <code class="lang-kotlin">acquisition</code> step, and the <code class="lang-kotlin">finalizer</code>. <a href="index.html">Resource</a> allocates and releases resources in a safe way that co-operates with Structured Concurrency, and KotlinX Coroutines.</p><p class="paragraph">It is especially useful when multiple resources that depend on each other need to be acquired, and later released in reverse order. Or when you want to compose other <code class="lang-kotlin">suspend</code> functionality into resource safe programs, such as concurrency, parallelism or Arrow's Effect.</p><p class="paragraph">Creating a <a href="index.html">Resource</a> <i>value</i> can be done using the <a href="../resource.html">resource</a> function, and running a program using <a href="../-resource-scope/index.html">ResourceScope</a> can be done using <a href="../resource-scope.html">resourceScope</a>, or <a href="../use.html">use</a>. Upon termination all finalizers are then guaranteed to run afterwards in reverse order of acquisition.</p><p class="paragraph">The following program is <strong>not-safe</strong> because it is prone to leak <code class="lang-kotlin">dataSource</code> and <code class="lang-kotlin">userProcessor</code> when an exception, or cancellation signal occurs whilst using the service.</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">class UserProcessor {<br>  fun start(): Unit = println("Creating UserProcessor")<br>  fun shutdown(): Unit = println("Shutting down UserProcessor")<br>}<br><br>class DataSource {<br>  fun connect(): Unit = println("Connecting dataSource")<br>  fun close(): Unit = println("Closed dataSource")<br>}<br><br>class Service(val db: DataSource, val userProcessor: UserProcessor) {<br>  suspend fun processData(): List&lt;String&gt; = throw RuntimeException("I'm going to leak resources by not closing them")<br>}<br><br>suspend fun main(): Unit {<br>  val userProcessor = UserProcessor().also { it.start() }<br>  val dataSource = DataSource().also { it.connect() }<br>  val service = Service(dataSource, userProcessor)<br><br>  service.processData()<br><br>  dataSource.close()<br>  userProcessor.shutdown()<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><!-- KNIT example-resource-01.kt --><p class="paragraph">If we were using Kotlin JVM, we might've relied on <code class="lang-kotlin">Closeable</code> or <code class="lang-kotlin">AutoCloseable</code> and rewritten our code to:</p><!-- INCLUDE
import java.io.Closeable

class UserProcessor : Closeable {
fun start(): Unit = println("Creating UserProcessor")
override fun close(): Unit = println("Shutting down UserProcessor")
}

class DataSource : Closeable {
fun connect(): Unit = println("Connecting dataSource")
override fun close(): Unit = println("Closed dataSource")
}

class Service(val db: DataSource, val userProcessor: UserProcessor) {
suspend fun processData(): List<String> = throw RuntimeException("I'm going to leak resources by not closing them")
}
--><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">suspend fun main(): Unit {<br>  UserProcessor().use { userProcessor -&gt;<br>    userProcessor.start()<br>    DataSource().use { dataSource -&gt;<br>      dataSource.connect()<br>      Service(dataSource, userProcessor).processData()<br>    }<br>  }<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><!-- KNIT example-resource-02.kt --><p class="paragraph">However, while we fixed closing of <code class="lang-kotlin">UserProcessor</code> and <code class="lang-kotlin">DataSource</code> there are issues still with this code:</p><ol><li><p class="paragraph">It requires implementing <code class="lang-kotlin">Closeable</code> or <code class="lang-kotlin">AutoCloseable</code>, only possible for Kotlin JVM, not available for Kotlin MPP</p></li><li><p class="paragraph">Requires implementing interface, or wrapping external types with i.e. <code class="lang-kotlin">class CloseableOf&lt;A&gt;(val type: A): Closeable</code>.</p></li><li><p class="paragraph">Requires nesting of different resources in callback tree, not composable.</p></li><li><p class="paragraph">Enforces <code class="lang-kotlin">close</code> method name, renamed <code class="lang-kotlin">UserProcessor#shutdown</code> to <code class="lang-kotlin">close</code></p></li><li><p class="paragraph">Cannot run suspend functions upon <i>fun close(): Unit</i>.</p></li><li><p class="paragraph">No exit signal, we don't know if we exited successfully, with an error or cancellation.</p></li></ol><p class="paragraph"><a href="index.html">Resource</a> solves of these issues. It defines 3 different steps:</p><ol><li><p class="paragraph">Acquiring the resource of <code class="lang-kotlin">A</code>.</p></li><li><p class="paragraph">Using <code class="lang-kotlin">A</code>.</p></li><li><p class="paragraph">Releasing <code class="lang-kotlin">A</code> with <a href="../-exit-case/-completed/index.html">ExitCase.Completed</a>, <a href="../-exit-case/-failure/index.html">ExitCase.Failure</a> or <a href="../-exit-case/-cancelled/index.html">ExitCase.Cancelled</a>.</p></li></ol><p class="paragraph">We rewrite our previous example to <a href="index.html">Resource</a> below by:</p><ol><li><p class="paragraph">Define <a href="index.html">Resource</a> for <code class="lang-kotlin">UserProcessor</code>.</p></li><li><p class="paragraph">Define <a href="index.html">Resource</a> for <code class="lang-kotlin">DataSource</code>, that also logs the <a href="../-exit-case/index.html">ExitCase</a>.</p></li><li><p class="paragraph">Compose <code class="lang-kotlin">UserProcessor</code> and <code class="lang-kotlin">DataSource</code> <a href="index.html">Resource</a> together into a <a href="index.html">Resource</a> for <code class="lang-kotlin">Service</code>.</p></li></ol><!-- INCLUDE
import arrow.fx.coroutines.Resource
import arrow.fx.coroutines.resource
import arrow.fx.coroutines.resourceScope
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.withContext

class UserProcessor {
suspend fun start(): Unit = withContext(Dispatchers.IO) { println("Creating UserProcessor") }
suspend fun shutdown(): Unit = withContext(Dispatchers.IO) {
    println("Shutting down UserProcessor")
}
}

class DataSource {
fun connect(): Unit = println("Connecting dataSource")
fun close(): Unit = println("Closed dataSource")
}

class Service(val db: DataSource, val userProcessor: UserProcessor) {
suspend fun processData(): List<String> = throw RuntimeException("I'm going to leak resources by not closing them")
}
--><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val userProcessor: Resource&lt;UserProcessor&gt; = resource({<br>  UserProcessor().also { it.start() }<br>}) { p, _ -&gt; p.shutdown() }<br><br>val dataSource: Resource&lt;DataSource&gt; = resource({<br>  DataSource().also { it.connect() }<br>}) { ds, exitCase -&gt;<br>  println("Releasing $ds with exit: $exitCase")<br>  withContext(Dispatchers.IO) { ds.close() }<br>}<br><br>val service: Resource&lt;Service&gt; = resource {<br>  Service(dataSource.bind(), userProcessor.bind())<br>}<br><br>suspend fun main(): Unit = resourceScope {<br>  val data = service.bind().processData()<br>  println(data)<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><!-- KNIT example-resource-03.kt --><p class="paragraph">There is a lot going on in the snippet above, which we'll analyse in the sections below. Looking at the above example it should already give you some idea if the capabilities of <a href="index.html">Resource</a>.</p><h2 class="">Resource constructors</h2><p class="paragraph"><a href="index.html">Resource</a> works entirely through a DSL, which allows <i>installing</i> a <code class="lang-kotlin">Resource</code> through the <code class="lang-kotlin">suspend fun &lt;A&gt; install(acquire: suspend () -&gt; A, release: suspend (A, ExitCase) -&gt; Unit): A</code> function.</p><p class="paragraph"><code class="lang-kotlin">acquire</code> is used to <i>allocate</i> the <code class="lang-kotlin">Resource</code>, and before returning the resource <code class="lang-kotlin">A</code> it also install the <code class="lang-kotlin">release</code> handler into the <code class="lang-kotlin">ResourceScope</code>.</p><p class="paragraph">We can use <code class="lang-kotlin">suspend fun</code> with <code class="lang-kotlin">Scope</code> as an extension function receiver to create synthetic constructors for our <code class="lang-kotlin">Resource</code>s. If you're using <i>context receivers</i> you can also use <code class="lang-kotlin">context(Scope)</code> instead.</p><!-- INCLUDE
import arrow.fx.coroutines.ResourceScope
import arrow.fx.coroutines.Resource
import arrow.fx.coroutines.resource
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.withContext

class UserProcessor {
suspend fun start(): Unit = withContext(Dispatchers.IO) { println("Creating UserProcessor") }
suspend fun shutdown(): Unit = withContext(Dispatchers.IO) {
    println("Shutting down UserProcessor")
}
}
--><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">suspend fun ResourceScope.userProcessor(): UserProcessor =<br>  install({  UserProcessor().also { it.start() } }) { processor, _ -&gt;<br>    processor.shutdown()<br>  }</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">We can of course also create <code class="lang-kotlin">lazy</code> representations of this by wrapping <code class="lang-kotlin">install</code> in <a href="../resource.html">resource</a> and returning the <code class="lang-kotlin">suspend lambda</code> value instead.</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val userProcessor: Resource&lt;UserProcessor&gt; = resource {<br>  val x: UserProcessor = install(<br>    {  UserProcessor().also { it.start() } },<br>    { processor, _ -&gt; processor.shutdown() }<br>  )<br>  x<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><p class="paragraph">There is also a convenience operator for this pattern, but you might have preferred <code class="lang-kotlin">ResourceScope::userProcessor</code> instead since it yields the same result.</p><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">val userProcessor2: Resource&lt;UserProcessor&gt; = resource({<br>  UserProcessor().also { it.start() }<br>}) { processor, _ -&gt; processor.shutdown() }<br><br>val userProcessor3: Resource&lt;UserProcessor&gt; = ResourceScope::userProcessor</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><!-- KNIT example-resource-04.kt --><h2 class="">Scope DSL</h2><p class="paragraph">The <a href="../-resource-scope/index.html">ResourceScope</a> DSL allows you to <i>install</i> resources, and interact with them in a safe way.</p><p class="paragraph">Arrow offers the same elegant <code class="lang-kotlin">bind</code> DSL for Resource composition as you might be familiar with from Arrow Core. Which we've already seen above, in our first example. What is more interesting, is that we can also compose it with any other existing pattern from Arrow! Let's compose our <code class="lang-kotlin">UserProcessor</code> and <code class="lang-kotlin">DataSource</code> in parallel, so that their <code class="lang-kotlin">start</code> and <code class="lang-kotlin">connect</code> methods can run in parallel.</p><!-- INCLUDE
import arrow.fx.coroutines.ResourceScope
import arrow.fx.coroutines.resourceScope
import arrow.fx.coroutines.parZip
import kotlinx.coroutines.Dispatchers
import kotlinx.coroutines.withContext

class UserProcessor {
suspend fun start(): Unit = withContext(Dispatchers.IO) { println("Creating UserProcessor") }
suspend fun shutdown(): Unit = withContext(Dispatchers.IO) {
    println("Shutting down UserProcessor")
}
}

class DataSource {
suspend fun connect(): Unit = withContext(Dispatchers.IO) { println("Connecting dataSource") }
suspend fun close(): Unit = withContext(Dispatchers.IO) { println("Closed dataSource") }
}

class Service(val db: DataSource, val userProcessor: UserProcessor) {
suspend fun processData(): List<String> = (0..10).map { "Processed : $it" }
}
--><div class="sample-container"><pre><code class="block lang-kotlin" theme="idea">suspend fun ResourceScope.userProcessor(): UserProcessor =<br>  install({ UserProcessor().also { it.start() } }){ p,_ -&gt; p.shutdown() }<br><br>suspend fun ResourceScope.dataSource(): DataSource =<br>  install({ DataSource().also { it.connect() } }) { ds, _ -&gt; ds.close() }<br><br>suspend fun main(): Unit = resourceScope {<br>  val service = parZip({ userProcessor() }, { dataSource() }) { userProcessor, ds -&gt;<br>    Service(ds, userProcessor)<br>  }<br>  val data = service.processData()<br>  println(data)<br>}</code></pre><span class="top-right-position"><span class="copy-icon"></span><div class="copy-popup-wrapper popup-to-left"><span class="copy-popup-icon"></span><span>Content copied to clipboard</span></div></span></div><!-- KNIT example-resource-05.kt --><h2 class="">Conclusion</h2><p class="paragraph"><a href="index.html">Resource</a> guarantee that their release finalizers are always invoked in the correct order when an exception is raised or the <span data-unresolved-link="kotlinx.coroutines/Job///PointingToDeclaration/">kotlinx.coroutines.Job</span> is running gets canceled.</p><p class="paragraph">To achieve this <a href="index.html">Resource</a> ensures that the <code class="lang-kotlin">acquire</code>&amp;<code class="lang-kotlin">release</code> step are <span data-unresolved-link="kotlinx.coroutines/NonCancellable///PointingToDeclaration/">NonCancellable</span>. If a cancellation signal, or an exception is received during <code class="lang-kotlin">acquire</code>, the resource is assumed to not have been acquired and thus will not trigger the release function. =&gt; Any composed resources that are already acquired they will be guaranteed to release as expected.</p><p class="paragraph">If you don't need a data-type like <a href="index.html">Resource</a> but want a function alternative to <code class="lang-kotlin">try/catch/finally</code> with automatic error composition, and automatic <span data-unresolved-link="kotlinx.coroutines/NonCancellable///PointingToDeclaration/">NonCancellable</span> <code class="lang-kotlin">acquire</code> and <code class="lang-kotlin">release</code> steps use <a href="../bracket-case.html">bracketCase</a> or <a href="../bracket.html">bracket</a>.</p></div></div>
  </div>
  <div class="tabbedcontent">
    <div class="tabs-section" tabs-section="tabs-section"><button class="section-tab" data-active="" data-togglable="CONSTRUCTOR,TYPE,PROPERTY,FUNCTION,EXTENSION_PROPERTY,EXTENSION_FUNCTION">Members &amp; Extensions</button></div>
    <div class="tabs-section-body"></div>
  </div>
</div>
    <div class="footer">
        <a href="#content" id="go-to-top-link" class="footer--button footer--button_go-to-top"></a>
        <span>© 2025 Copyright</span>
        <span class="pull-right">
            <span>Generated by </span>
            <a class="footer--link footer--link_external" href="https://github.com/Kotlin/dokka">
                <span>dokka</span>
            </a>
        </span>
    </div>
            </div>
        </div>
    </div>
</body>
</html>
