<h2 id="iso">Iso</h2>

<p>An <code class="highlighter-rouge">Iso</code> is a loss less invertible optic that defines an isomorphism between a type <code class="highlighter-rouge">S</code> and <code class="highlighter-rouge">A</code> i.e. a data class and its properties represented by <code class="highlighter-rouge">TupleN</code>.</p>

<p>Isos can be seen as a pair of functions that represent an isomorphism, <code class="highlighter-rouge">get</code> and <code class="highlighter-rouge">reverseGet</code>. So an <code class="highlighter-rouge">Iso&lt;S, A&gt;</code> represents two getters: <code class="highlighter-rouge">get: (S) -&gt; A</code> and <code class="highlighter-rouge">reverseGet: (A) -&gt; S</code> where <code class="highlighter-rouge">S</code> is called the source of the <code class="highlighter-rouge">Iso</code> and <code class="highlighter-rouge">A</code> is called the focus or target of the <code class="highlighter-rouge">Iso</code>.</p>

<p>A simple structure <code class="highlighter-rouge">Point2D</code> is equivalent to <code class="highlighter-rouge">Tuple2&lt;Int, Int&gt;</code> so we can create an <code class="highlighter-rouge">Iso&lt;Point2D, Tuple2&lt;Int, Int&gt;&gt;</code></p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">arrow.*</span>
<span class="k">import</span> <span class="nn">arrow.core.*</span>
<span class="k">import</span> <span class="nn">arrow.optics.*</span>

<span class="kd">data class</span> <span class="nc">Point2D</span><span class="p">(</span><span class="kd">val</span> <span class="py">x</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="kd">val</span> <span class="py">y</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span>

<span class="kd">val</span> <span class="py">pointIsoTuple</span><span class="p">:</span> <span class="n">Iso</span><span class="p">&lt;</span><span class="n">Point2D</span><span class="p">,</span> <span class="n">Tuple2</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;&gt;</span> <span class="p">=</span> <span class="n">Iso</span><span class="p">(</span>
    <span class="k">get</span> <span class="p">=</span> <span class="p">{</span> <span class="n">point</span> <span class="p">-&gt;</span> <span class="n">point</span><span class="p">.</span><span class="n">x</span> <span class="n">toT</span> <span class="n">point</span><span class="p">.</span><span class="n">y</span> <span class="p">},</span>
    <span class="n">reverseGet</span> <span class="p">=</span> <span class="p">{</span> <span class="n">tuple</span> <span class="p">-&gt;</span> <span class="n">Point2D</span><span class="p">(</span><span class="n">tuple</span><span class="p">.</span><span class="n">a</span><span class="p">,</span> <span class="n">tuple</span><span class="p">.</span><span class="n">b</span><span class="p">)</span> <span class="p">}</span>
<span class="p">)</span>

<span class="kd">val</span> <span class="py">point</span> <span class="p">=</span> <span class="n">Point2D</span><span class="p">(</span><span class="m">6</span><span class="p">,</span> <span class="m">10</span><span class="p">)</span>
<span class="n">point</span>
<span class="c1">// Point2D(x=6, y=10)</span>
</code></pre></div></div>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">tuple</span> <span class="p">=</span> <span class="n">pointIsoTuple</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
<span class="n">tuple</span>
<span class="c1">// Tuple2(a=6, b=10)</span>
</code></pre></div></div>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">pointIsoTuple</span><span class="p">.</span><span class="n">reverseGet</span><span class="p">(</span><span class="n">tuple</span><span class="p">)</span>
<span class="c1">// Point2D(x=6, y=10)</span>
</code></pre></div></div>

<p>Given an <code class="highlighter-rouge">Iso&lt;Point2D, Tuple2&lt;Int, Int&gt;&gt;</code> we also have an <code class="highlighter-rouge">Iso&lt;Tuple2&lt;Int, Int&gt;, Point2D&gt;</code> since it represents an isomorphism between equivalent structures we can reverse it.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">reversedIso</span><span class="p">:</span> <span class="n">Iso</span><span class="p">&lt;</span><span class="n">Tuple2</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;,</span> <span class="n">Point2D</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">pointIsoTuple</span><span class="p">.</span><span class="n">reverse</span><span class="p">()</span>
</code></pre></div></div>

<p>Using an <code class="highlighter-rouge">Iso</code> we can modify our source <code class="highlighter-rouge">S</code> with a function that works on our focus <code class="highlighter-rouge">A</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">addFive</span><span class="p">:</span> <span class="p">(</span><span class="n">Tuple2</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;)</span> <span class="p">-&gt;</span> <span class="n">Tuple2</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="p">{</span> <span class="n">tuple2</span> <span class="p">-&gt;</span> <span class="p">(</span><span class="n">tuple2</span><span class="p">.</span><span class="n">a</span> <span class="p">+</span> <span class="m">5</span><span class="p">)</span> <span class="n">toT</span> <span class="p">(</span><span class="n">tuple2</span><span class="p">.</span><span class="n">b</span> <span class="p">+</span> <span class="m">5</span><span class="p">)</span> <span class="p">}</span>
<span class="n">pointIsoTuple</span><span class="p">.</span><span class="n">modify</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">addFive</span><span class="p">)</span>
<span class="c1">// Point2D(x=11, y=15)</span>
</code></pre></div></div>

<p>A function <code class="highlighter-rouge">(A) -&gt; A</code> can be lifted to a function <code class="highlighter-rouge">(S) -&gt; S</code></p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">liftedAddFive</span><span class="p">:</span> <span class="p">(</span><span class="n">Point2D</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">Point2D</span> <span class="p">=</span> <span class="n">pointIsoTuple</span><span class="p">.</span><span class="n">lift</span><span class="p">(</span><span class="n">addFive</span><span class="p">)</span>
<span class="n">liftedAddFive</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
<span class="c1">// Point2D(x=11, y=15)</span>
</code></pre></div></div>

<p>We can do the same with a Functor mapping</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">arrow.data.*</span>

<span class="n">pointIsoTuple</span><span class="p">.</span><span class="n">modifyF</span><span class="p">(</span><span class="n">Try</span><span class="p">.</span><span class="n">functor</span><span class="p">(),</span> <span class="n">point</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Try</span> <span class="p">{</span> <span class="p">(</span><span class="n">tuple</span><span class="p">.</span><span class="n">a</span> <span class="p">/</span> <span class="m">2</span><span class="p">)</span> <span class="n">toT</span> <span class="p">(</span><span class="n">tuple</span><span class="p">.</span><span class="n">b</span> <span class="p">/</span> <span class="m">2</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>
<span class="c1">// Success(value=Point2D(x=3, y=5))</span>
</code></pre></div></div>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">liftF</span><span class="p">:</span> <span class="p">(</span><span class="n">Point2D</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">TryOf</span><span class="p">&lt;</span><span class="n">Point2D</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">pointIsoTuple</span><span class="p">.</span><span class="n">liftF</span><span class="p">(</span><span class="n">Try</span><span class="p">.</span><span class="n">functor</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">Try</span> <span class="p">{</span> <span class="p">(</span><span class="n">tuple</span><span class="p">.</span><span class="n">a</span> <span class="p">/</span> <span class="m">2</span><span class="p">)</span> <span class="n">toT</span> <span class="p">(</span><span class="n">tuple</span><span class="p">.</span><span class="n">b</span> <span class="p">/</span> <span class="m">0</span><span class="p">)</span> <span class="p">}</span>
<span class="p">}</span>

<span class="n">liftF</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
<span class="c1">// Failure(exception=java.lang.ArithmeticException: / by zero)</span>
</code></pre></div></div>

<h3 id="composition">Composition</h3>

<p>By composing isos we can create additional isos without defining them. When dealing with different APIs or frameworks we frequently run into multiple equivalent but different structures like <code class="highlighter-rouge">Point2D</code>, <code class="highlighter-rouge">Tuple2</code>, <code class="highlighter-rouge">Pair</code>, <code class="highlighter-rouge">Coord</code>, etc.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">data class</span> <span class="nc">Coord</span><span class="p">(</span><span class="kd">val</span> <span class="py">xAxis</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="kd">val</span> <span class="py">yAxis</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span>

<span class="kd">val</span> <span class="py">pairIsoCoord</span><span class="p">:</span> <span class="n">Iso</span><span class="p">&lt;</span><span class="n">Pair</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;,</span> <span class="n">Coord</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">Iso</span><span class="p">(</span>
        <span class="k">get</span> <span class="p">=</span> <span class="p">{</span> <span class="n">pair</span> <span class="p">-&gt;</span> <span class="n">Coord</span><span class="p">(</span><span class="n">pair</span><span class="p">.</span><span class="n">first</span><span class="p">,</span> <span class="n">pair</span><span class="p">.</span><span class="n">second</span><span class="p">)</span> <span class="p">},</span>
        <span class="n">reverseGet</span> <span class="p">=</span> <span class="p">{</span> <span class="n">coord</span> <span class="p">-&gt;</span> <span class="n">coord</span><span class="p">.</span><span class="n">xAxis</span> <span class="n">to</span> <span class="n">coord</span><span class="p">.</span><span class="n">yAxis</span> <span class="p">}</span>
<span class="p">)</span>

<span class="kd">val</span> <span class="py">tupleIsoPair</span><span class="p">:</span> <span class="n">Iso</span><span class="p">&lt;</span><span class="n">Tuple2</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;,</span> <span class="n">Pair</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;&gt;</span> <span class="p">=</span> <span class="n">Iso</span><span class="p">(</span>
        <span class="k">get</span> <span class="p">=</span> <span class="p">{</span> <span class="n">tuple</span> <span class="p">-&gt;</span> <span class="n">tuple</span><span class="p">.</span><span class="n">a</span> <span class="n">to</span> <span class="n">tuple</span><span class="p">.</span><span class="n">b</span> <span class="p">},</span>
        <span class="n">reverseGet</span> <span class="p">=</span> <span class="p">{</span> <span class="n">pair</span> <span class="p">-&gt;</span> <span class="n">pair</span><span class="p">.</span><span class="n">first</span> <span class="n">toT</span> <span class="n">pair</span><span class="p">.</span><span class="n">second</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<p>By composing <code class="highlighter-rouge">pointIsoTuple</code>, <code class="highlighter-rouge">pairIsoCoord</code> and <code class="highlighter-rouge">tupleIsoPair</code> (and/or reversing) we can use <code class="highlighter-rouge">Point2D</code>, <code class="highlighter-rouge">Tuple2&lt;Int, Int&gt;</code>, <code class="highlighter-rouge">Pair&lt;Int, Int&gt;</code> and <code class="highlighter-rouge">Coord</code> interchangeably as we can lift functions to the required structure.</p>

<p>Composing an <code class="highlighter-rouge">Iso</code> with functions can also be useful to change input or output type of a function. In the <code class="highlighter-rouge">Iso&lt;A?, Option&lt;A&gt;&gt;</code> is available in <code class="highlighter-rouge">arrow-optics</code> as <code class="highlighter-rouge">nullableToOption()</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">unknownCode</span><span class="p">:</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="n">String</span><span class="p">?</span> <span class="p">=</span> <span class="p">{</span> <span class="n">value</span> <span class="p">-&gt;</span>
    <span class="s">"unkown $value"</span>
<span class="p">}</span>

<span class="kd">val</span> <span class="py">nullableOptionIso</span><span class="p">:</span> <span class="n">Iso</span><span class="p">&lt;</span><span class="n">String</span><span class="p">?,</span> <span class="n">Option</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;&gt;</span> <span class="p">=</span> <span class="n">nullableToOption</span><span class="p">()</span>
<span class="p">(</span><span class="n">unknownCode</span> <span class="n">andThen</span> <span class="n">nullableOptionIso</span><span class="o">::</span><span class="k">get</span><span class="p">)(</span><span class="s">"Retrieve an Option"</span><span class="p">)</span>
</code></pre></div></div>

<p><code class="highlighter-rouge">Iso</code> can be composed with all optics and composition them results in the following optics.</p>

<table>
  <thead>
    <tr>
      <th>Â </th>
      <th>Iso</th>
      <th>Lens</th>
      <th>Prism</th>
      <th>Optional</th>
      <th>Getter</th>
      <th>Setter</th>
      <th>Fold</th>
      <th>Traversal</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Iso</td>
      <td>Iso</td>
      <td>Lens</td>
      <td>Prism</td>
      <td>Optional</td>
      <td>Getter</td>
      <td>Setter</td>
      <td>Fold</td>
      <td>Traversal</td>
    </tr>
  </tbody>
</table>

<h3 id="generating-isos">Generating isos</h3>

<p>To avoid boilerplate, isos can be generated for a <code class="highlighter-rouge">data class</code> to <code class="highlighter-rouge">TupleN</code> with 2 to 10 parameters by the <code class="highlighter-rouge">@optics</code> annotation. The <code class="highlighter-rouge">Iso</code> will be generated in the same package as the <code class="highlighter-rouge">data class</code> and will be named <code class="highlighter-rouge">classnameIso()</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">@optics</span> <span class="kd">data class</span> <span class="nc">Pos</span><span class="p">(</span><span class="kd">val</span> <span class="py">x</span><span class="p">:</span> <span class="n">Int</span><span class="p">,</span> <span class="kd">val</span> <span class="py">y</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span>
</code></pre></div></div>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">iso</span><span class="p">:</span> <span class="n">Iso</span><span class="p">&lt;</span><span class="n">Pos</span><span class="p">,</span> <span class="n">Tuple2</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;&gt;</span> <span class="p">=</span> <span class="n">posIso</span><span class="p">()</span>
</code></pre></div></div>

<h3 id="polymorphic-isos">Polymorphic isos</h3>
<p>When dealing with polymorphic equivalent structures we can create polymorphic isos to allow us to morph the type of the focus (and as a result the constructed type) of our <code class="highlighter-rouge">PIso</code>.</p>

<p>Given our previous structures <code class="highlighter-rouge">Tuple2&lt;A, B&gt;</code> and <code class="highlighter-rouge">Pair&lt;A, B&gt;</code> we can create a polymorphic <code class="highlighter-rouge">PIso</code> that represents a <code class="highlighter-rouge">get: (Tuple2&lt;A, B&gt;) -&gt; Pair&lt;A, B&gt;</code> and a <code class="highlighter-rouge">reverseGet: (Tuple2&lt;C, D) -&gt; Pair&lt;C, D&gt;</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">fun</span> <span class="p">&lt;</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">&gt;</span> <span class="n">tuple2</span><span class="p">():</span> <span class="n">PIso</span><span class="p">&lt;</span><span class="n">Tuple2</span><span class="p">&lt;</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">&gt;,</span> <span class="n">Pair</span><span class="p">&lt;</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">&gt;,</span> <span class="n">Pair</span><span class="p">&lt;</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">&gt;,</span> <span class="n">Tuple2</span><span class="p">&lt;</span><span class="n">C</span><span class="p">,</span> <span class="n">D</span><span class="p">&gt;&gt;</span> <span class="p">=</span> <span class="n">PIso</span><span class="p">(</span>
        <span class="p">{</span> <span class="n">tuple</span> <span class="p">-&gt;</span> <span class="n">tuple</span><span class="p">.</span><span class="n">a</span> <span class="n">to</span> <span class="n">tuple</span><span class="p">.</span><span class="n">b</span> <span class="p">},</span>
        <span class="p">{</span> <span class="n">tuple</span> <span class="p">-&gt;</span> <span class="n">tuple</span><span class="p">.</span><span class="n">a</span> <span class="n">to</span> <span class="n">tuple</span><span class="p">.</span><span class="n">b</span> <span class="p">}</span>
<span class="p">)</span>
</code></pre></div></div>

<p>Above defined <code class="highlighter-rouge">PIso</code> can lift a <code class="highlighter-rouge">reverse</code> function of <code class="highlighter-rouge">(Pair&lt;A, B&gt;) -&gt; Tuple2&lt;B, A&gt;</code> to a function <code class="highlighter-rouge">(Tuple2&lt;A, B&gt;) -&gt; Pair&lt;B, A&gt;</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">val</span> <span class="py">reverseTupleAsPair</span><span class="p">:</span> <span class="p">(</span><span class="n">Tuple2</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">,</span> <span class="n">String</span><span class="p">&gt;)</span> <span class="p">-&gt;</span> <span class="n">Pair</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span>
        <span class="n">tuple2</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;().</span><span class="n">lift</span> <span class="p">{</span> <span class="n">intStringPair</span> <span class="p">-&gt;</span> <span class="n">intStringPair</span><span class="p">.</span><span class="n">second</span> <span class="n">toT</span> <span class="n">intStringPair</span><span class="p">.</span><span class="n">first</span> <span class="p">}</span>
<span class="kd">val</span> <span class="py">reverse</span><span class="p">:</span> <span class="n">Pair</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">Int</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">reverseTupleAsPair</span><span class="p">(</span><span class="m">5</span> <span class="n">toT</span> <span class="s">"five"</span><span class="p">)</span>
<span class="n">reverse</span>
<span class="c1">//(five, 5)</span>
</code></pre></div></div>

<h3 id="laws">Laws</h3>

<p>Arrow provides <a href="https://github.com/arrow-kt/arrow/blob/master/arrow-test/src/main/kotlin/arrow/laws/IsoLaws.kt" target="_blank"><code class="highlighter-rouge">IsoLaws</code></a> in the form of test cases for internal verification of lawful instances and third party apps creating their own isos.</p>

